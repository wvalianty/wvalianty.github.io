---
layout: post
title: 流量攻击和防御 
categories: 故障排查
description: 流量攻击和防御 
keywords: ddos cc 
---
## 一、攻击
这里主要介绍防御，但是也离不开攻击，知己知彼才百战百胜。
常见的几种网络攻击有 DDOS、CC、SQL注入、慢攻击。

#### 1、什么是 DDOS
分布式拒绝服务，协议一般是 tcp 协议。
#### 2、什么是 CC
一般针对 http 协议，打满带宽，针对服务器资源，性能，使服务器的 CPU 飙升到 100%，CC 攻击是模拟正常的请求。
#### 3、慢速攻击
在建立了与HTTP服务器的连接后，尽量长时间保持该连接，不释放，达到对HTTP服务器的攻击。
Slow POST: 攻击者发送Post报文向服务器请求提交数据，将总报文长度设置为一个很大的数值，但是在随后的数据发送中，每次只发送很小的报文，这样导致服务器端一直等待攻击者发送数据。
Slow headers: 攻击者通过GET或者POST向服务器建立连接，但是HTTP头字段不发送结束符，之后发送其他字段进行保活。服务器会一直等待头信息中结束符而导致连接始终被占用。
#### 4、ip 包攻击
本机并没有监听端口，但是对方通过伪装发送 ip 包的攻击。
## 二、防御
有多种攻击，那么一般的防御方案是怎样的呢？
#### 1、SQL注入的防御方案
sql 注入一般使用云产品进行防护。aws 的 waf 可以。阿里云也有对应的产品。
#### 2、DDOS防御方案
由于 aws 的负载均衡可以动态扩容，所以一般大流量，aws 似乎可以天然有一些防御。
在阿里云，阿里云有着对应的云产品，没有经历过自己做。
#### 3、aws 另外两种防御产品
shield，直接开就好。
#### 4、CC 防御
CC 防御是这里的主角。CC 的主要防御办法是限制频率。正常的 nginx 可以限制频率，但是粒度不够，所以可以借用 lua 来实现扩展，可以是实现针对路径等更多情情况等限频率。那么限制频率怎么实现呢？这里主要有两种方案，一种是 redis 的 expire key，另一种是利用 lua 的第三方库实现一个计数器。通过上面两个方法实现对一个借口访问频率的控制。
## 三、展望未来
一个 web 防御，静态资源不需要，需要防御的是一些动态接口。防御的根本还是网络，如果是应用层面，那就是 http 协议，要对 http 协议有更加深入的了解。
使用经验，当网站上云的防御产品的时候，发生过本来可以正常打开的，没有办法打开了，被防御产品拦截了。所以这种防御产品，研发需要了解，整个网站链都需要了解。
## 四、 参考 
[CC攻击原理及防范方法](https://www.cnblogs.com/wpjamer/p/9030259.html)  
[HTTP慢速攻击与防御原理](https://forum.huawei.com/enterprise/zh/thread-293945.html)  
[DDoS攻击的方式](https://www.huaweicloud.com/zhishi/dyl45.html)  

